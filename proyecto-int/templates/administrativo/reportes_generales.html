{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reportes Generales ‚Äî Hospital Cl√≠nico Herminda Mart√≠n</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f4f7fa;
      font-family: "Segoe UI", sans-serif;
    }
    .header-section {
      background-color: #334155;
      color: white;
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 2rem;
    }
    .btn-rol {
      background-color: #475569;
      color: white;
      border: none;
    }
    .btn-rol:hover {
      background-color: #1e293b;
      color: white;
    }
    .report-section {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .report-section h4 {
      color: #334155;
      border-bottom: 2px solid #334155;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }
    .table-report {
      font-size: 0.9rem;
    }
    .table-report th {
      background-color: #f8f9fa;
      font-weight: 600;
    }
    .highlight-cell {
      background-color: #fff3cd;
    }
  </style>
</head>
<body>
  <div class="container mt-4 mb-5">
    <div class="header-section">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h3 class="mb-0">üìä Reportes Generales del Sistema</h3>
          <p class="mb-0">Hospital Cl√≠nico Herminda Mart√≠n ‚Äî Chill√°n</p>
        </div>
        <div>
          <a href="{% url 'exportar_reporte_pdf' %}?fecha_desde={{ fecha_desde }}&fecha_hasta={{ fecha_hasta }}" 
             class="btn btn-danger me-2" target="_blank">üìÑ Exportar PDF</a>
          <a href="{% url 'exportar_reporte_excel' %}?fecha_desde={{ fecha_desde }}&fecha_hasta={{ fecha_hasta }}" 
             class="btn btn-success me-2">üìä Exportar Excel</a>
          <a href="{% url 'dashboard_admin' %}" class="btn btn-outline-light">Volver</a>
        </div>
      </div>
    </div>

    <!-- Filtros de Fecha -->
    <div class="card mb-4">
      <div class="card-body">
        <form method="get" class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Fecha Desde</label>
            <input type="date" name="fecha_desde" class="form-control" value="{{ fecha_desde }}">
          </div>
          <div class="col-md-4">
            <label class="form-label">Fecha Hasta</label>
            <input type="date" name="fecha_hasta" class="form-control" value="{{ fecha_hasta }}">
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-rol w-100">Filtrar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- SECCI√ìN D.1: INFORMACI√ìN GENERAL DE RECI√âN NACIDOS VIVOS -->
    <div class="report-section">
      <h4>SECCI√ìN D.1: INFORMACI√ìN GENERAL DE RECI√âN NACIDOS VIVOS</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-report">
          <thead>
            <tr>
              <th>TIPO</th>
              <th>TOTAL</th>
              <th colspan="8">PESO AL NACER (EN GRAMOS)</th>
              <th>Anomal√≠a Cong√©nita</th>
            </tr>
            <tr>
              <th></th>
              <th></th>
              <th>&lt;500</th>
              <th>500-999</th>
              <th>1.000-1.499</th>
              <th>1.500-1.999</th>
              <th>2.000-2.499</th>
              <th>2.500-2.999</th>
              <th>3.000-3.999</th>
              <th>4.000 y m√°s</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>NACIDOS VIVOS</strong></td>
              <td><strong>{{ total_nacidos_vivos }}</strong></td>
              <td>{{ peso_menor_500 }}</td>
              <td>{{ peso_500_999 }}</td>
              <td>{{ peso_1000_1499 }}</td>
              <td>{{ peso_1500_1999 }}</td>
              <td>{{ peso_2000_2499 }}</td>
              <td>{{ peso_2500_2999 }}</td>
              <td>{{ peso_3000_3999 }}</td>
              <td>{{ peso_4000_mas }}</td>
              <td>{{ anomalia_congenita }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- SECCI√ìN D.2: ATENCI√ìN INMEDIATA DEL RECI√âN NACIDO -->
    <div class="report-section">
      <h4>SECCI√ìN D.2: ATENCI√ìN INMEDIATA DEL RECI√âN NACIDO</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-report">
          <thead>
            <tr>
              <th rowspan="2">TIPO</th>
              <th colspan="2">PROFILAXIS</th>
              <th colspan="3">TIPO DE PARTO</th>
              <th colspan="4">APGAR</th>
            </tr>
            <tr>
              <th>Hepatitis B</th>
              <th>Ocular</th>
              <th>Parto Vaginal</th>
              <th>Parto Instrumental</th>
              <th>Ces√°rea</th>
              <th>1 min ‚â§3</th>
              <th>5 min ‚â§5</th>
              <th>Reanimaci√≥n B√°sica</th>
              <th>Reanimaci√≥n Avanzada</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>NACIDOS VIVOS</strong></td>
              <td>{{ profilaxis_hepatitis_b }}</td>
              <td>{{ profilaxis_ocular }}</td>
              <td>{{ parto_vaginal }}</td>
              <td>{{ parto_instrumental }}</td>
              <td>{{ cesarea }}</td>
              <td>{{ apgar_1min_menor_igual_3 }}</td>
              <td>{{ apgar_5min_menor_igual_5 }}</td>
              <td>{{ reanimacion_basica_count }}</td>
              <td>{{ reanimacion_avanzada_count }}</td>
            </tr>
            <tr>
              <td><strong>TOTAL DE PARTOS</strong></td>
              <td colspan="9"><strong>{{ total_partos }}</strong></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- CARACTER√çSTICAS DEL PARTO -->
    <div class="report-section">
      <h4>CARACTER√çSTICAS DEL PARTO</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-report">
          <thead>
            <tr>
              <th>TIPO</th>
              <th>TOTAL</th>
              <th colspan="4">PARTOS SEG√öN EDAD DE LA MADRE</th>
              <th colspan="4">PARTOS PREMATUROS (considerar sobre 22 semanas)</th>
            </tr>
            <tr>
              <th></th>
              <th></th>
              <th>&lt;15 a√±os</th>
              <th>15 a 19 a√±os</th>
              <th>20 a 34 a√±os</th>
              <th>35 a√±os y m√°s</th>
              <th>22-24 semanas</th>
              <th>24-28 semanas</th>
              <th>28-32 semanas</th>
              <th>32-37 semanas</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>TOTAL PARTOS</strong></td>
              <td><strong>{{ total_partos }}</strong></td>
              <td>{{ partos_menor_15 }}</td>
              <td>{{ partos_15_19 }}</td>
              <td>{{ partos_20_34 }}</td>
              <td>{{ partos_35_mas }}</td>
              <td>{{ partos_22_24_semanas }}</td>
              <td>{{ partos_24_28_semanas }}</td>
              <td>{{ partos_28_32_semanas }}</td>
              <td>{{ partos_32_37_semanas }}</td>
            </tr>
            <tr>
              <td>VAGINAL</td>
              <td>{{ partos_vaginal }}</td>
              <td colspan="8"></td>
            </tr>
            <tr>
              <td>INSTRUMENTAL</td>
              <td>{{ partos_instrumental }}</td>
              <td colspan="8"></td>
            </tr>
            <tr>
              <td>CES√ÅREA ELECTIVA</td>
              <td>{{ cesarea_electiva }}</td>
              <td colspan="8"></td>
            </tr>
            <tr>
              <td>CES√ÅREA URGENCIA</td>
              <td>{{ cesarea_urgencia }}</td>
              <td colspan="8"></td>
            </tr>
            <tr class="highlight-cell">
              <td><strong>Lactancia materna en las primeras 60 minutos de vida con peso ‚â• 2.500 gr.</strong></td>
              <td><strong>{{ lactancia_60min }}</strong></td>
              <td colspan="8"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- SECCI√ìN D: APLICACI√ìN DE PROFILAXIS OCULAR -->
    <div class="report-section">
      <h4>SECCI√ìN D: APLICACI√ìN DE PROFILAXIS OCULAR PARA GONORREA EN RECI√âN NACIDOS</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-report">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Total</th>
              <th>Pueblos Originarios</th>
              <th>Migrantes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Reci√©n nacidos vivos que reciben profilaxis ocular para gonorrea al nacer</td>
              <td>{{ profilaxis_ocular_total }}</td>
              <td>{{ profilaxis_ocular_pueblos }}</td>
              <td>{{ profilaxis_ocular_migrantes }}</td>
            </tr>
            <tr>
              <td>Reci√©n nacidos vivos</td>
              <td>{{ total_nacidos_vivos }}</td>
              <td>{{ pueblos_originarios }}</td>
              <td>{{ migrantes }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- SECCI√ìN J: PROFILAXIS HEPATITIS B -->
    <div class="report-section">
      <h4>SECCI√ìN J: PROFILAXIS DE TRANSMISI√ìN VERTICAL APLICADA AL RECI√âN NACIDO, HIJO DE MADRE HEPATITIS B POSITIVA</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-report">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Total</th>
              <th>Pueblos Originarios</th>
              <th>Migrantes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Reci√©n nacidos hijos de madre Hepatitis B positiva, nacidos en el periodo</td>
              <td>{{ rn_hepatitis_b_con_profilaxis|add:rn_hepatitis_b_sin_profilaxis }}</td>
              <td>0</td>
              <td>0</td>
            </tr>
            <tr>
              <td>Reci√©n nacidos hijos de madre Hepatitis B positiva que recibieron profilaxis completa, seg√∫n la normativa vigente</td>
              <td>{{ rn_hepatitis_b_con_profilaxis }}</td>
              <td>0</td>
              <td>0</td>
            </tr>
            <tr>
              <td>Reci√©n nacidos hijos de madre Hepatitis B positiva, sin profilaxis aplicada</td>
              <td>{{ rn_hepatitis_b_sin_profilaxis }}</td>
              <td>0</td>
              <td>0</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>

