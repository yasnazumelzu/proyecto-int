{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalle Alta y Egreso ‚Äî Administrativo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f4f7fa;
      font-family: "Segoe UI", sans-serif;
    }
    .header-section {
      background-color: #334155;
      color: white;
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 2rem;
    }
    .btn-rol {
      background-color: #475569;
      color: white;
      border: none;
    }
    .btn-rol:hover {
      background-color: #1e293b;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <div class="header-section">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h3 class="mb-0">üìã Detalle de Alta y Egreso</h3>
          <p class="mb-0">Paciente: {{ alta.paciente.nombre }}</p>
        </div>
        <div>
          <a href="{% url 'lista_altas_egresos' %}" class="btn btn-outline-light">Volver</a>
        </div>
      </div>
    </div>

    <!-- Informaci√≥n B√°sica -->
    <div class="card mb-4">
      <div class="card-header bg-dark text-white">
        <h5 class="mb-0">Informaci√≥n B√°sica</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Paciente:</strong> {{ alta.paciente.nombre }}</p>
            <p><strong>RUT:</strong> {{ alta.paciente.rut }}</p>
            <p><strong>Admisi√≥n:</strong> #{{ alta.admision.id }} - {{ alta.admision.get_tipo_admision_display }}</p>
            <p><strong>Fecha de Alta:</strong> {{ alta.fecha_alta|date:"d/m/Y H:i" }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Tipo de Alta:</strong> {{ alta.get_tipo_alta_display }}</p>
            <p><strong>Estado del Episodio:</strong> 
              {% if alta.estado_episodio == 'cerrado' %}
                <span class="badge bg-success">Cerrado</span>
              {% else %}
                <span class="badge bg-warning">Abierto</span>
              {% endif %}
            </p>
            <p><strong>Registrado por:</strong> {{ alta.usuario_registro.username|default:"-" }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Documentos Entregados -->
    <div class="card mb-4">
      <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Documentos Entregados</h5>
        {% if alta.estado_episodio == 'abierto' %}
        <a href="{% url 'entregar_documentos' alta.id %}" class="btn btn-light btn-sm">üìÑ Entregar Documentos</a>
        {% endif %}
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Documento de Alta:</strong> 
              {% if alta.documento_alta_entregado %}
                <span class="badge bg-success">‚úì Entregado</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendiente</span>
              {% endif %}
            </p>
            <p><strong>Certificado de Defunci√≥n:</strong> 
              {% if alta.certificado_defuncion_entregado %}
                <span class="badge bg-success">‚úì Entregado</span>
              {% else %}
                <span class="badge bg-secondary">No aplica</span>
              {% endif %}
            </p>
            <p><strong>Informe M√©dico:</strong> 
              {% if alta.informe_medico_entregado %}
                <span class="badge bg-success">‚úì Entregado</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendiente</span>
              {% endif %}
            </p>
            <p><strong>Recetas:</strong> 
              {% if alta.recetas_entregadas %}
                <span class="badge bg-success">‚úì Entregadas</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendientes</span>
              {% endif %}
            </p>
          </div>
          <div class="col-md-6">
            {% if alta.fecha_entrega_documentos %}
            <p><strong>Fecha de Entrega:</strong> {{ alta.fecha_entrega_documentos|date:"d/m/Y H:i" }}</p>
            {% endif %}
            {% if alta.persona_que_recibio %}
            <p><strong>Persona que Recibi√≥:</strong> {{ alta.persona_que_recibio }}</p>
            {% endif %}
            {% if alta.otros_documentos %}
            <p><strong>Otros Documentos:</strong> {{ alta.otros_documentos }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Tr√°mites Administrativos -->
    <div class="card mb-4">
      <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Tr√°mites Administrativos</h5>
        {% if alta.estado_episodio == 'abierto' %}
        <a href="{% url 'tramites_administrativos' alta.id %}" class="btn btn-light btn-sm">‚öôÔ∏è Gestionar Tr√°mites</a>
        {% endif %}
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Pagos Completados:</strong> 
              {% if alta.pagos_completados %}
                <span class="badge bg-success">‚úì Completado</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendiente</span>
              {% endif %}
            </p>
            <p><strong>Facturaci√≥n Cerrada:</strong> 
              {% if alta.facturacion_cerrada %}
                <span class="badge bg-success">‚úì Cerrada</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendiente</span>
              {% endif %}
            </p>
            <p><strong>Habitaci√≥n Liberada:</strong> 
              {% if alta.habitacion_liberada %}
                <span class="badge bg-success">‚úì Liberada</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendiente</span>
              {% endif %}
            </p>
          </div>
          <div class="col-md-6">
            <p><strong>Expediente Cl√≠nico Archivado:</strong> 
              {% if alta.expediente_clinico_archivado %}
                <span class="badge bg-success">‚úì Archivado</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendiente</span>
              {% endif %}
            </p>
            <p><strong>Notificaciones Enviadas:</strong> 
              {% if alta.notificaciones_enviadas %}
                <span class="badge bg-success">‚úì Enviadas</span>
              {% else %}
                <span class="badge bg-danger">‚úó Pendientes</span>
              {% endif %}
            </p>
          </div>
        </div>
        {% if alta.tramites_adicionales %}
        <div class="mt-3">
          <p><strong>Tr√°mites Adicionales:</strong></p>
          <p>{{ alta.tramites_adicionales }}</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Observaciones -->
    {% if alta.observaciones %}
    <div class="card mb-4">
      <div class="card-header bg-dark text-white">
        <h5 class="mb-0">Observaciones</h5>
      </div>
      <div class="card-body">
        <p>{{ alta.observaciones }}</p>
      </div>
    </div>
    {% endif %}

    <!-- Acciones -->
    {% if alta.estado_episodio == 'abierto' %}
    <div class="card">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">Acciones Disponibles</h5>
      </div>
      <div class="card-body">
        <div class="d-flex gap-2">
          <a href="{% url 'entregar_documentos' alta.id %}" class="btn btn-primary">üìÑ Entregar Documentos</a>
          <a href="{% url 'tramites_administrativos' alta.id %}" class="btn btn-info">‚öôÔ∏è Tr√°mites Administrativos</a>
          <a href="{% url 'cerrar_episodio' alta.id %}" class="btn btn-success">‚úì Cerrar Episodio</a>
        </div>
      </div>
    </div>
    {% else %}
    <div class="alert alert-success">
      <strong>‚úì Episodio Cerrado</strong> - Este episodio ha sido cerrado exitosamente.
    </div>
    {% endif %}
  </div>
</body>
</html>

