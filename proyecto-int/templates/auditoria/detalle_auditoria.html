{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalle de Auditor√≠a ‚Äî TI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f5f5f5;
      font-family: "Segoe UI", sans-serif;
    }
    .header-section {
      background-color: #2196F3;
      color: white;
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 2rem;
    }
    .btn-ti {
      background-color: #2196F3;
      color: white;
      border: none;
    }
    .btn-ti:hover {
      background-color: #1976D2;
      color: white;
    }
    pre {
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 5px;
      max-height: 400px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <div class="header-section">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h3 class="mb-0">üìã Detalle de Registro de Auditor√≠a</h3>
          <p class="mb-0">ID: {{ registro.id }}</p>
        </div>
        <div>
          <a href="{% url 'lista_auditoria' %}" class="btn btn-outline-light">Volver</a>
        </div>
      </div>
    </div>

    <!-- Informaci√≥n B√°sica -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Informaci√≥n B√°sica</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Fecha y Hora:</strong> {{ registro.fecha_hora|date:"d/m/Y H:i:s" }}</p>
            <p><strong>Usuario:</strong> {{ registro.usuario.username|default:"An√≥nimo" }} 
              {% if registro.usuario %}({{ registro.usuario.get_full_name|default:registro.usuario.email }}){% endif %}</p>
            <p><strong>M√©todo HTTP:</strong> <code>{{ registro.metodo_http }}</code></p>
            <p><strong>Acci√≥n:</strong> 
              <span class="badge 
                {% if registro.accion == 'CREATE' %}bg-success
                {% elif registro.accion == 'READ' %}bg-info
                {% elif registro.accion == 'UPDATE' %}bg-warning
                {% elif registro.accion == 'DELETE' %}bg-danger
                {% elif registro.accion == 'LOGIN' %}bg-primary
                {% elif registro.accion == 'LOGOUT' %}bg-secondary
                {% else %}bg-dark{% endif %}">
                {{ registro.get_accion_display }}
              </span>
            </p>
          </div>
          <div class="col-md-6">
            <p><strong>URL:</strong> <code>{{ registro.url }}</code></p>
            <p><strong>Ruta:</strong> {{ registro.ruta|default:"-" }}</p>
            <p><strong>Vista:</strong> {{ registro.nombre_vista|default:"-" }}</p>
            <p><strong>C√≥digo de Respuesta:</strong> 
              {% if registro.exito %}
                <span class="badge bg-success">{{ registro.codigo_respuesta|default:"-" }}</span>
              {% else %}
                <span class="badge bg-danger">{{ registro.codigo_respuesta|default:"-" }}</span>
              {% endif %}
            </p>
            <p><strong>Estado:</strong> 
              {% if registro.exito %}
                <span class="badge bg-success">Exitoso</span>
              {% else %}
                <span class="badge bg-danger">Error</span>
              {% endif %}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Informaci√≥n del Modelo -->
    {% if registro.nombre_modelo %}
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Modelo Afectado</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Modelo:</strong> {{ registro.nombre_modelo }}</p>
            {% if registro.object_id %}
            <p><strong>ID del Objeto:</strong> {{ registro.object_id }}</p>
            {% endif %}
            {% if registro.content_type %}
            <p><strong>Content Type:</strong> {{ registro.content_type }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Datos Enviados -->
    {% if registro.datos_enviados %}
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Datos Enviados</h5>
      </div>
      <div class="card-body">
        <pre>{{ registro.datos_enviados|pprint }}</pre>
      </div>
    </div>
    {% endif %}

    <!-- Datos de Respuesta -->
    {% if registro.datos_respuesta %}
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Datos de Respuesta</h5>
      </div>
      <div class="card-body">
        <pre>{{ registro.datos_respuesta|pprint }}</pre>
      </div>
    </div>
    {% endif %}

    <!-- Informaci√≥n T√©cnica -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Informaci√≥n T√©cnica</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Direcci√≥n IP:</strong> {{ registro.ip_address|default:"-" }}</p>
            <p><strong>User Agent:</strong> {{ registro.user_agent|default:"-"|truncatechars:100 }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje de Error -->
    {% if registro.mensaje_error %}
    <div class="card mb-4 border-danger">
      <div class="card-header bg-danger text-white">
        <h5 class="mb-0">Mensaje de Error</h5>
      </div>
      <div class="card-body">
        <pre class="text-danger">{{ registro.mensaje_error }}</pre>
      </div>
    </div>
    {% endif %}

    <!-- Observaciones -->
    {% if registro.observaciones %}
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Observaciones</h5>
      </div>
      <div class="card-body">
        <p>{{ registro.observaciones }}</p>
      </div>
    </div>
    {% endif %}
  </div>
</body>
</html>

